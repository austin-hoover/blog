---
title: "Eigenpainting: a novel method to mitigate space charge in high-intensity hadron beams"
author: Austin Hoover
date: 2026-01-29
bibliography: references.bib
csl: ./aps.csl
categories:
  - accelerators
  - papers
draft: false
format:
  html:
    toc: true
    toc-expand: 1
    number-sections: true
    fig-align: left
---

Our paper, [*Demonstration of a novel phase-space painting method in a coupled lattice to mitigate space charge in high-intensity hadron beams*](https://journals.aps.org/prl/accepted/10.1103/b vwq-34jf), was recently accepted for publication in Physical Review Letters (PRL) @evans_2026_demonstration. Here's the [preprint](https://arxiv.org/pdf/2601.13517). The paper describes the first experimental test of a method that we call *eigenpainting*, originally proposed by Viatcheslav (Slava) Danilov twenty years ago @danilov_2003_self.^[Danilov also proposed Nonlinear Integrable Optics (NIO) @danilov_2010_nonlinear and Laser-Assisted Charge Exchange (LACE) @danilov_2003_lace.] This post expands on the paper, providing some additional background information and figures. 


## Introduction  {#sec-intro}

Accelerators such as the [SNS](https://neutrons.ornl.gov/sns) and [J-PARC](https://j-parc.jp/c/en/) use [*charge-exchange injection*](../2021-05-27_painting-a-particle-beam) to create intense proton beams for neutron scattering experiments. The injection is a three-step process: H- (negative hydrogren) ions are accelerated in a linac, converted to protons using a carbon foil or laser-magnet system, and then transfered to an accumulator ring. We call each batch of injected protons a *minipulse*. After the first minipulse completes one lap around the ring, a second is injected, and so on for hundreds or thousands of turns.

Vanilla charge-exchange injection leads to charge pile-up at the injection point, leading to halo formation and beam loss. This motivates the technique of *phase space painting*: movement of the injection point in phase space (position-momentum space) during accumulation. At a basic level, painting lets us spread the charge over a larger area in the ring, reducing the peak density and associated space charge effects. Painting can also enable more detailed control of the distribution, although this is challenging because each injected minipulse changes the beam dynamics on the subsequent turn.

Our study focuses on two questions related to phase space painting. First, what is the target beam distribution? In @sec-vortex, I'll argue that *vortex distributions* are an attractive option for several applications of high-intensity beams. Second, suppose we've identified a target distribution: can we paint it? I'll address this question in @sec-eigenpainting, which introduces *eigenpainting* as a method to paint vortex distributions in the presence of space charge. Finally, in @sec-exp, I'll explain our attempt to implement this method in the SNS accumulator ring.


## Vortex distributions {#sec-vortex}

A *vortex distribution* is characterized by a spiral pattern in its velocity field.

![Examples of vortex distributions.](images/vortex.png){#fig-vortex fig-align=center width=400px}

We will characterize the distribution using the concept of *emittance*, a measure of phase space volume. Emittances are functions of the covariance matrix $\mathbf{\Sigma}$:

$$
\mathbf{\Sigma}
=
\begin{bmatrix}
\langle{xx}\rangle & \langle{xx'}\rangle & \langle{xy}\rangle & \langle{xy'}\rangle \\
\langle{x'x}\rangle & \langle{x'x'}\rangle & \langle{x'y}\rangle & \langle{x'y'}\rangle \\
\langle{yx}\rangle & \langle{yx'}\rangle & \langle{yy}\rangle & \langle{yy'}\rangle \\
\langle{y'x}\rangle & \langle{y'x'}\rangle & \langle{y'y}\rangle & \langle{y'y'}\rangle
\end{bmatrix} ,
$${#eq-cov}

where $x$-$y$ are the transverse positions, $x'$-$y'$ are the velocities. The covariance matrix defines an ellipsoid from the expression $\mathbf{x}^T \mathbf{\Sigma}^{-1} \mathbf{x} = 1$. The four-dimensional emittance $\varepsilon_{4D}$ is the volume of the ellipsoid:

$$
\varepsilon_{4D} = \sqrt{\det{\mathbf{\Sigma}}}.
$${#eq-4d-emitt}

From Liouville's Theorem, the four-dimensional emittance is conserved under linear symplectic transformations. We can also write the four-dimensional emittance as the product of the *intrinsic* emittances $\varepsilon_{1, 2}$, which are individually conserved:

$$
\varepsilon_{4D} = \varepsilon_{1}\varepsilon_{2} .
$$

The intrinsic emittances are calculated from a symplectic diagonalization of $\mathbf{\Sigma}$:

$$
\mathbf{\Sigma}
=
\mathbf{V}
\begin{bmatrix}
\varepsilon_1 & 0 & 0 & 0 \\
0 & \varepsilon_1 & 0 & 0 \\
0 & 0 & \varepsilon_2 & 0 \\
0 & 0 & 0 & \varepsilon_2 
\end{bmatrix}
\mathbf{V}^T ,
$${#eq-cov-diag}

where $\mathbf{V}$ is a symplectic matrix. Finally, there are the *projected* emittances $\varepsilon_{x, y}$:

$$
\begin{aligned}
\varepsilon_x &= \sqrt{\det{\mathbf{\Sigma}_{xx}}} , \\
\varepsilon_y &= \sqrt{\det{\mathbf{\Sigma}_{yy}}} , \\
\end{aligned}
$${#eq-proj-emitt}

where 

$$
\mathbf{\Sigma} = 
\begin{bmatrix}
    \mathbf{\Sigma}_{xx}   & \mathbf{\Sigma}_{xy} \\
    \mathbf{\Sigma}_{xy}^T & \mathbf{\Sigma}_{yy}
\end{bmatrix} .
$${#eq-cov-uncoupled}

The projected emittances define ellipse areas in the $x$-$x'$ and $y$-$y'$ planes. Thus, the projected emittance ratio $\varepsilon_x / \varepsilon_y$ tells us the fraction of particles that occupy the horizontal mode compared to the vertical mode of oscillation. The intrinsic emittances have a similar interpretation. The intrinsic emittance ratio $\varepsilon_1 / \varepsilon_2$ tells us the fraction of particles that occupy one mode compared to another mode of oscillation, where the modes are defined by the symplectic matrix $\mathbf{V}$ in @eq-cov-diag. For example, if $\mathbf{V}$ is the identity matrix, then the two modes correspond to $x$ and $y$. In general, the modes correspond to *elliptical* trajectories in the $x$-$y$ plane. For example, the particles in @fig-vortex predominantly occupy one elliptical mode.

This brings us to the characterization of vortex distributions: *a vortex distribution has a large intrinsic emittance ratio: $\varepsilon_1 \gg \varepsilon_2$*. 


::: {#fig-cov layout-ncol=2}

![Phase space coordinates](images/cov.png){#fig-cov-a}

![Normalized coordinates](images/cov_norm.png){#fig-cov-a}

Covariance ellipses before and after normalization (symplectic diagonalization of the covariance matrix). (Click to enlarge.)
:::



There are several possible applications of vortex distributions in high-intensity accelerators. First, vortex distributions could be used to increase the luminosity of a hadron collider @burov_2013_circular. To maximize the luminosity (the number of collisions per unit time per unit area), we want to maximize the particle density at the collision point. Unfortunately, the density is fundamentally limited by space charge forces in the low-energy stages of the accelerator. But we can play a trick: we can accumulate a round vortex beam, accelerate it to high energy, and then remove its angular momentum using a series of skew quadrupoles. The skew quadrupoles simply map the projected emittances to the intrinsic emittances, as in @fig-cov. Since the initial beam has a large intrinsic emittance ratio, the final beam has a large projected emittance ratio. This is the so-called round-to-flat (RTF) transformation @kim_2003_round shown in @fig-roundflat. Since inter-particle forces are negligble at higher energies, this scheme essentially bipasses the space charge limit on the beam density.

![A round-to-flat transformation removes all cross-plane correlations, mapping the projected emittances $\varepsilon_{x, y}$ to the intrinsic emittances $\varepsilon_{1, 2}$. Since one of the intrinsic emittances is zero, the transformation maps a round, spinning beam to a flat beam. Source: [my talk](https://conference.sns.gov/event/335/contributions/528/attachments/892/8194/2022-10-26_Hoover_space_charge_workshop.pdf).](images/roundflat.png){#fig-roundflat }

![Concept of round-to-flat transformation in a collider. Phase space painting would be used to accumulate a low-energy beam with large angular momentum. The RTF transformation produces a flat beam at the collision point. [LHC diagram](https://cds.cern.ch/record/2693837/files/Poster-2019-858.pdf).](images/collider.png){#fig-collider}



Vortex distributions could also be used to mitigate space charge effects. Consider a simplified model that represents the beam as a frozen background potential $\phi(x, y)$. In a Gaussian distribution, the potential contains terms proportional to $x^2$, $x^4$, and so on. These terms act as nonlinear driving forces which excite resonances at certain frequencies. These resonances are sometimes called *space charge structure resonances*. The classic example is the fourth-order resonance, which creates four islands in $x$-$x'$ phase space. Recently, Cheon et al. @cheon_2022_spinning showed that angular momentum can suppress the fourth-order resonance in linear accelerators (@fig-fourth), and I expect the same could hold in circular accelerators. A pure vortex beam with $\varepsilon_2 = 0$ is an extreme case in which there is absolutely no relative motion of particles in the beam.

![Fourth-order resonance suppression from angular momentum in a bunched beam. Particles in the spinning beam avoid direct passage through the oscillating beam core. Source: @cheon_2022_spinning.](images/fourth.png){#fig-fourth}

Space charge can also excite [nonlinear resonances](../2021-03-28_nonlinear-resonances) driven by the accelerator lattice. Space charge shifts the particle tunes based on the location in the bunch. For example, @fig-tunespread shows the tune spread within a Gaussian distribution. As the intensity increases, the tune spread grows and more particles enter forbidden regions of tune space. Thus, space charge essentially broadens the resonance stop-bands in the lattice. 

![Tune spreads in increasingly nonuniform distributions. Source: @franchetti_2017_space.](images/tunespread.png){#fig-tunespread fig-align=center}

It would be nice if we could generate a uniform-density bunch, which completely eliminates the tune spread.^[This is only true in the absence of coherent instabilities...] There is only one arangement of particles which projects to the desired density while maintaining a finite emittance: the KV distribution. The KV distribution is an equilibrium solution of the Vlasov-Poisson equations, which describe the self-consistent dynamics of the beam in response to external and self-generated forces. If we start with a KV distribution in the ring, it will maintain its functional form as it evolves. This is a remarkable fact that I don't have the space to discuss here. The point is that the KV distribution is an obvious target if we want to minimize the tune spread.

The connection to vortex beams comes when we try to *paint* the KV distribution. It is *impossible* to paint a KV distribution in the presence of space charge. Well, not impossible: we can easily paint a completely *flat* KV distribution, i.e., a KV distribution with $\varepsilon_y = 0$ or $\varepsilon_x = 0$. But then we're back to the same problem: the flat beam will have enormous density and associate space charge forces. Again, we can play a trick: linearly map the flat KV distribution to a round, rotating distribution. It will turn out that we *can* paint the round, rotating distribution, which has zero four-dimensional emittance ($\varepsilon_2 \ll \varepsilon_1$) but still projects to a uniform density in the $x$-$y$ plane. I'll explain this more when defining the painting methods in the next section.


## Eigenpainting {#sec-eigenpainting}

![](images/corner_eig_ellipse.png)

*Eigenpainting* is a method to paint a high-intensity vortex distribution. The method utilizes the eigenvector analysis of linear motion in an accelerator ring. Suppose the phase space coordinates $\mathbf{x}$ evolve according to

$$
\mathbf{x} \rightarrow \mathbf{Mx} ,
$${#eq-one-turn-map}

where $\rightarrow$ represents tracking through one period and $\mathbf{M}$ is a symplectic matrix. The eigenvectors of $\mathbf{M}$ solve

$$
\mathbf{Mv}_k = e^{-i\mu_k} \mathbf{v}_k ,
$${#eq-label}

where $k = 1, 2$. We can write the phase space coordinates as a linear combination of the eigenvectors:

$$
\mathbf{x} = \text{Re} \left\{ 
    \sqrt{2 J_1}\mathbf{v}_1e^{-i\psi_1} + 
    \sqrt{2 J_2}\mathbf{v}_2e^{-i\psi_2} 
\right\},
$${#eq-cvec}

where $J_{1, 2}$ are initial amplitudes, $\psi_{1, 2}$ are initial phases, and $\text{Re}\{\dots\}$ selects the non-imaginary component. The transfer matrix simply adds a phase to each eigenvector.

$$
\mathbf{Mx} = \text{Re} \left\{ 
    \sqrt{2 J_1}\mathbf{v}_1 e^{-i\left(\psi_1 + \mu_1\right)} + 
    \sqrt{2 J_2}\mathbf{v}_2 e^{-i(\psi_2 + \mu_2)}
\right\}.
$${#eq-cvec_evolved}

The real component of $\mathbf{v}_1$ traces an ellipse of area $2 J_1$. Similarly, the real component of $\mathbf{v}_2$ traces an ellipse of area $2 J_2$. If there is no coupling in the lattice (block-diagonal $\mathbf{M}$), the ellipses will be aligned with the $x$-$x'$ and $y$-$y'$ planes; otherwise the ellipses will have different orientations.

Suppose we continuously inject particles at a fixed point in phase space. As the particles advance in phase, they become uniformly distributed on the ellipse traced by each eigenvector. Therefore, the final distribution depends only on the injection amplitudes, not the phases. By varying the amplitudes as a function of time, we can generate arbitrary elliptically symmetric distributions $f(J_1)$ and $f(J_2)$. The full four-dimensional distribution $f(J_1, J_2)$ will depend on the path taken through the $J_1$-$J_2$ space.

*Eigenpainting* is the choice to inject along only one of the eigenvectors. In other words, we move only along $J_1$ or $J_2$.

![UPDATE](images/paint_diag_abc.png){#fig-paint-diag}


[Explain V matrix]


In the normalized phase space, the distribution will look like this:

![](images/paint_eig_n.gif){#fig-paint-eig-n width=500px fig-align=left}

In the actual distribution will be a linear transformation of @fig-paint-flat. The specific form depends on the matrix $\mathbf{V}$. Here's one example:

![](images/paint_eig.gif){#fig-paint-eig width=500px fig-align=left}




## Experimental implementation of eigenpainting  {#sec-exp}

Test

## Questions and future work  {#sec-conclusion}


Test
