---
title: "Eigenpainting: a method to mitigate space charge in high-intensity hadron beams"
author: Austin Hoover
date: 2026-01-30
bibliography: references.bib
csl: ./aps.csl
categories:
  - accelerators
  - papers
draft: false
format:
  html:
    toc: false
    toc-expand: 1
    number-sections: true
    fig-align: left
---

Our paper, [*Demonstration of a novel phase-space painting method in a coupled lattice to mitigate space charge in high-intensity hadron beams*](https://journals.aps.org/prl/accepted/10.1103/b vwq-34jf), was recently accepted for publication in Physical Review Letters (PRL) @evans_2026_demonstration. Here's the [preprint](https://arxiv.org/pdf/2601.13517). The paper describes the first experimental test of a method that we call *eigenpainting*, originally proposed by Viatcheslav (Slava) Danilov twenty years ago @danilov_2003_self.^[Danilov also proposed Nonlinear Integrable Optics (NIO) @danilov_2010_nonlinear and Laser-Assisted Charge Exchange (LACE) @danilov_2003_lace.] This post provides some additional background information and figures to help interpret the results.


## Introduction  {#sec-intro}

Accelerators such as the [SNS](https://neutrons.ornl.gov/sns) and [J-PARC](https://j-parc.jp/c/en/) use [*charge-exchange injection*](../2021-05-27_painting-a-particle-beam) to create intense proton beams for neutron scattering experiments. The injection is a three-step process: H- (negative hydrogren) ions are accelerated in a linac, converted to protons using a carbon foil or laser-magnet system, and then transfered to an accumulator ring. We call each batch of injected protons a *minipulse*. After the first minipulse completes one lap around the ring, a second is injected, and so on for hundreds or thousands of turns.

Vanilla charge-exchange injection leads to charge pile-up at the injection point, leading to halo formation and beam loss. This motivates the technique of *phase space painting*: the movement of the injection point in phase space (position-momentum space) during accumulation. At a basic level, painting lets us spread the charge over a larger area, reducing the peak density and associated space charge effects. Painting can also enable more detailed control of the phase space distribution, although this is challenging because each injected minipulse changes the beam dynamics on the subsequent turn.

Eigenpainting is proposed method to paint *stationary* four-dimensional phase space distributions, even in the presence of space charge. The method is derived from the eigenvector analysis of coupled motion, which I'll summarize in @sec-method. In @sec-app, I'll describe several possible applications of eigenpainting. In the ideal case, eigenpainting generates a beam with zero volume in the four-dimensional phase space which could be used to increase luminosity in high-energy hadron colliders. The beam would also have a large angular momentum and a uniform density, both of which could mitigate nonlinear space charge forces. Finally, in @sec-exp, I'll describe our attempt to implement eigenpainting in the SNS and  our plans for follow-up experiments.


## Eigenvectors, eigenvalues, and eigenpainting {#sec-method}


### Eigenvector analysis

In the linear approximation, the phase space coordinates $\mathbf{x}$ in a ring evolve according to

$$
\mathbf{x} \rightarrow \mathbf{M} \mathbf{x} ,
$${#eq-one-turn-map}

where $\mathbf{M}$ is a symplectic matrix and $\rightarrow$ represents tracking through one lap. For example, @fig-track shows the coordinates of a particle tracked over 1000 turns in the SNS ring.

![Turn-by-turn phase space coordinates over 1000 turns in a ring.](images/track.png){#fig-track width=450 fig-align=left}

We can simplify the the motion using the eigenvectors of the transfer matrix. The eigenvectors solve

$$
\mathbf{Mv}_k = e^{-i\mu_k} \mathbf{v}_k ,
$${#eq-label}

where $k = 1, 2$. Since the eigenvectors form a basis, we can write the phase space coordinate vector as

$$
\mathbf{x} = \text{Re} \left\{ 
    \sqrt{2 J_1} \mathbf{v}_1 e^{-i\psi_1} + 
    \sqrt{2 J_2} \mathbf{v}_2 e^{-i\psi_2} 
\right\} .
$${#eq-cvec}

Here, $J_{1, 2}$ are initial amplitudes, $\psi_{1, 2}$ are initial phases, and $\text{Re}\{\dots\}$ selects the non-imaginary component. The transfer matrix simply adds a phase to each eigenvector:

$$
\mathbf{Mx} = \text{Re} \left\{ 
    \sqrt{2 J_1}\mathbf{v}_1 e^{-i\left(\psi_1 + \mu_1\right)} + 
    \sqrt{2 J_2}\mathbf{v}_2 e^{-i(\psi_2 + \mu_2)}
\right\}.
$${#eq-cvec_evolved}

The amplitudes $J_{1, 2}$ are therefore invariants of the motion.

At a fixed point in the ring, the real component of eigenvector $\mathbf{v}_k$ traces a two-dimensional ellipse of area $2 J_k$ at frequency $\mu_k / 2\pi$. We can see this in @fig-track-ellipse, which plots the eigenvector paths on top of the tracking data. If there is no coupling in the lattice (block-diagonal transfer matrix), the first ellipse will align with the $x$-$x'$ axis and the second with the $y$-$y'$ axis; otherwise, the ellipses can have different orientations in the four-dimensional phase space.

![Eigenvector paths (red/blue) plotted on top of turn-by-turn tracking data.](images/track_ellipse.png){#fig-track-ellipse width=450px fig-align=left}


### Normalized coordinates

We can use the eigenvectors to construct a symplectic matrix $\mathbf{V}$,

$$
\mathbf{V} = 
\left[ 
    +\Re\{\mathbf{v}_1\} 
    -\Im\{\mathbf{v}_1\} 
    +\Re\{\mathbf{v}_2\} 
    -\Im\{\mathbf{v}_2\} 
\right] ,
$${#eq-norm-matrix-constr}

that converts $\mathbf{M}$ to block-diagonal form:

$$\mathbf{V^{-1} M V} = 
\begin{bmatrix}
    \cos{\mu_1} & \sin{\mu_1}  & 0 & 0 \\
    -\sin{\mu_1} & \cos{\mu_1}  & 0 & 0 \\
    0 & 0 & \cos{\mu_2} & \sin{\mu_2} \\
    0 & 0 & -\sin{\mu_2} & \cos{\mu_2}
\end{bmatrix} .
$${#eq-label}

In the "normalized" coordinates $\mathbf{u} = \mathbf{V}^{-1} \mathbf{x}$ (also be called *action-angle* or *phase-amplitude* coordinates), the particle simply rotates in each phase plane with frequencies $\mu_k$.

$$
\mathbf{u} = \begin{bmatrix}
  +\sqrt{2J_1}\cos{(\psi_1 + \mu_1)} \\
  -\sqrt{2J_1}\sin{(\psi_1 + \mu_1)} \\
  +\sqrt{2J_2}\cos{(\psi_2 + \mu_2)} \\
  -\sqrt{2J_2}\sin{(\psi_2 + \mu_2)}
\end{bmatrix}.
$${#eq-label}

![Normalized tracking data.](images/track_norm.png){#fig-track-norm fig-align=left width=450px}


### Single-mode injection

The idea behind eigenpainting is to inject particles into only one mode, i.e., along only one of the eigenvectors. Suppose we continuously inject particles at a fixed amplitude $J_1$ and phase $\psi_1$. The injected particles will advance in phase, eventually filling the ellipse traced by the eigenvector. If we inject particles at a different amplitude, the particles will fill a larger or smaller ellipse. Thus, by varying the injection amplitude as a function of time, we can build any elliptically symmetric distribution $f(J_1)$.

We'll focus on the specific choice of linearly increasing amplitude:

$$
\begin{aligned}
J_1(t) &= \tilde{J}_1 t , \\
J_2(t) &= 0 ,
\end{aligned}
$$

where $\tilde{J}_1$ is a maximum value of $J_1$. We could also paint into the other mode by swapping $J_1$ and $J_2$. We can represent the painting path as a curve in the $J_1$-$J_2$ space:

![](images/paint_diag.png){width=170px fig-align=center}

In normalized coordinates, the distribution will look like this:

![Eigenpainting in normalized coordinates.](images/paint_eig_n.gif){#fig-paint-eig-n width=500px fig-align=left}

The linear scaling of the amplitude creates a uniform disk in the first phase plane, while particles in the second phase plane are concentrated at the origin. In reality, the injected minipulse will have a nonzero phase space volume, so we end up with a small blob.

Note that this normalized distribution is always the same. The actual distribution will depend on $\mathbf{V}$, which encodes the structure of the accelerator lattice. For example, @fig-paint-eig shows the result of painting into the SNS ring.

![Eigenpainting in the SNS ring (linear approximation, no space charge).](images/paint_eig.gif){#fig-paint-eig width=500px fig-align=left}

Space charge typically invalidates methods based on single-particle, linear dynamcs. Incredibly, eigenpainting works just fine. Notice that the painted distribution projects to a uniform density within an elliptical envelope. The charge distribution produces an electric field which has *linear* dependence on the $x$-$y$ coordinates. Therefore, space charge simply modifies the lattice transfer matrix $\mathbf{M}$ to a new effective transfer matrix $\hat{\mathbf{M}}$. We can then construct a new normalization matrix $\hat{\mathbf{V}}$ from $\hat{\mathbf{M}}$ and perform eigenpainting as before. 

Another critical point is that the painted distribution is *stationary* with respect to turn number. The painted distribution is an equilibrium solution of the Vlasov-Poisson equations, known as the KV distribution @qin_2009_generalized. Equilibrium distributions are functions of invariants ($J_1$ in this case) and therefore preserve their functional form in phase space as they evolve. This ensures the space charge forces remains linear at all times, no matter the external forces, as long as the external forces are linear. Furthermore, the distribution is in equilibrium at all times $t$; the only change is a global scaling factor as particles are added to the edge of the beam ellipse.


## Applications of eigenpainting {#sec-app}

Now that eigenpainting is defined, let's discuss what it could be used for. 

A *vortex distribution* is characterized by a spiral pattern in its velocity field.

![Examples of vortex distributions.](images/vortex.png){#fig-vortex fig-align=left width=400px}

We will characterize the distribution using the concept of *emittance*, a measure of phase space volume. Emittances are functions of the covariance matrix $\mathbf{\Sigma}$:

$$
\mathbf{\Sigma}
=
\begin{bmatrix}
\langle{xx}\rangle & \langle{xx'}\rangle & \langle{xy}\rangle & \langle{xy'}\rangle \\
\langle{x'x}\rangle & \langle{x'x'}\rangle & \langle{x'y}\rangle & \langle{x'y'}\rangle \\
\langle{yx}\rangle & \langle{yx'}\rangle & \langle{yy}\rangle & \langle{yy'}\rangle \\
\langle{y'x}\rangle & \langle{y'x'}\rangle & \langle{y'y}\rangle & \langle{y'y'}\rangle
\end{bmatrix} ,
$${#eq-cov}

where $x$-$y$ are the transverse positions, $x'$-$y'$ are the velocities. The covariance matrix defines an ellipsoid from the expression $\mathbf{x}^T \mathbf{\Sigma}^{-1} \mathbf{x} = 1$. The four-dimensional emittance $\varepsilon_{4D}$ is the volume of the ellipsoid:

$$
\varepsilon_{4D} = \sqrt{\det{\mathbf{\Sigma}}}.
$${#eq-4d-emitt}

From Liouville's Theorem, the four-dimensional emittance is conserved under linear symplectic transformations. We can also write the four-dimensional emittance as the product of the *intrinsic* emittances $\varepsilon_{1, 2}$, which are individually conserved:

$$
\varepsilon_{4D} = \varepsilon_{1}\varepsilon_{2} .
$$

The intrinsic emittances are calculated from a symplectic diagonalization of $\mathbf{\Sigma}$:

$$
\mathbf{\Sigma}
=
\mathbf{V}
\begin{bmatrix}
\varepsilon_1 & 0 & 0 & 0 \\
0 & \varepsilon_1 & 0 & 0 \\
0 & 0 & \varepsilon_2 & 0 \\
0 & 0 & 0 & \varepsilon_2 
\end{bmatrix}
\mathbf{V}^T ,
$${#eq-cov-diag}

where $\mathbf{V}$ is a symplectic matrix. Finally, there are the *projected* emittances $\varepsilon_{x, y}$:

$$
\begin{aligned}
\varepsilon_x &= \sqrt{\det{\mathbf{\Sigma}_{xx}}} , \\
\varepsilon_y &= \sqrt{\det{\mathbf{\Sigma}_{yy}}} , \\
\end{aligned}
$${#eq-proj-emitt}

where 

$$
\mathbf{\Sigma} = 
\begin{bmatrix}
    \mathbf{\Sigma}_{xx}   & \mathbf{\Sigma}_{xy} \\
    \mathbf{\Sigma}_{xy}^T & \mathbf{\Sigma}_{yy}
\end{bmatrix} .
$${#eq-cov-uncoupled}

The projected emittances define ellipse areas in the $x$-$x'$ and $y$-$y'$ planes. Thus, the projected emittance ratio $\varepsilon_x / \varepsilon_y$ tells us the fraction of particles that occupy the horizontal mode compared to the vertical mode of oscillation. The intrinsic emittances have a similar interpretation. The intrinsic emittance ratio $\varepsilon_1 / \varepsilon_2$ tells us the fraction of particles that occupy one mode compared to another mode of oscillation, where the modes are defined by the symplectic matrix $\mathbf{V}$ in @eq-cov-diag. For example, if $\mathbf{V}$ is the identity matrix, then the two modes correspond to $x$ and $y$. In general, the modes correspond to *elliptical* trajectories in the $x$-$y$ plane. For example, the particles in @fig-vortex predominantly occupy one elliptical mode.

This brings us to the characterization of vortex distributions: *a vortex distribution has a large intrinsic emittance ratio: $\varepsilon_1 \gg \varepsilon_2$*. 


::: {#fig-cov layout-ncol=2}

![Phase space coordinates](images/cov.png){#fig-cov-a}

![Normalized coordinates](images/cov_norm.png){#fig-cov-a}

Covariance ellipses before and after normalization (symplectic diagonalization of the covariance matrix). (Click to enlarge.)
:::



There are several possible applications of vortex distributions in high-intensity accelerators. First, vortex distributions could be used to increase the luminosity of a hadron collider @burov_2013_circular. To maximize the luminosity (the number of collisions per unit time per unit area), we want to maximize the particle density at the collision point. Unfortunately, the density is fundamentally limited by space charge forces in the low-energy stages of the accelerator. But we can play a trick: we can accumulate a round vortex beam, accelerate it to high energy, and then remove its angular momentum using a series of skew quadrupoles. The skew quadrupoles simply map the projected emittances to the intrinsic emittances, as in @fig-cov. Since the initial beam has a large intrinsic emittance ratio, the final beam has a large projected emittance ratio. This is the so-called round-to-flat (RTF) transformation @kim_2003_round shown in @fig-roundflat. Since inter-particle forces are negligble at higher energies, this scheme essentially bipasses the space charge limit on the beam density.

![A round-to-flat transformation removes all cross-plane correlations, mapping the projected emittances $\varepsilon_{x, y}$ to the intrinsic emittances $\varepsilon_{1, 2}$. Since one of the intrinsic emittances is zero, the transformation maps a round, spinning beam to a flat beam. Source: [my talk](https://conference.sns.gov/event/335/contributions/528/attachments/892/8194/2022-10-26_Hoover_space_charge_workshop.pdf).](images/roundflat.png){#fig-roundflat }

![Concept of round-to-flat transformation in a collider. Phase space painting would be used to accumulate a low-energy beam with large angular momentum. The RTF transformation produces a flat beam at the collision point. [LHC diagram](https://cds.cern.ch/record/2693837/files/Poster-2019-858.pdf).](images/collider.png){#fig-collider}



Vortex distributions could also be used to mitigate space charge effects. Consider a simplified model that represents the beam as a frozen background potential $\phi(x, y)$. In a Gaussian distribution, the potential contains terms proportional to $x^2$, $x^4$, and so on. These terms act as nonlinear driving forces which excite resonances at certain frequencies. These resonances are sometimes called *space charge structure resonances*. The classic example is the fourth-order resonance, which creates four islands in $x$-$x'$ phase space. Recently, Cheon et al. @cheon_2022_spinning showed that angular momentum can suppress the fourth-order resonance in linear accelerators (@fig-fourth), and I expect the same could hold in circular accelerators. A pure vortex beam with $\varepsilon_2 = 0$ is an extreme case in which there is absolutely no relative motion of particles in the beam.

![Fourth-order resonance suppression from angular momentum in a bunched beam. Particles in the spinning beam avoid direct passage through the oscillating beam core. Source: @cheon_2022_spinning.](images/fourth.png){#fig-fourth}

Space charge can also excite [nonlinear resonances](../2021-03-28_nonlinear-resonances) driven by the accelerator lattice. Space charge shifts the particle tunes based on the location in the bunch. For example, @fig-tunespread shows the tune spread within a Gaussian distribution. As the intensity increases, the tune spread grows and more particles enter forbidden regions of tune space. Thus, space charge essentially broadens the resonance stop-bands in the lattice. 

![Tune spreads in increasingly nonuniform distributions. Source: @franchetti_2017_space.](images/tunespread.png){#fig-tunespread fig-align=left}

It would be nice if we could generate a uniform-density bunch, which completely eliminates the tune spread.^[This is only true in the absence of coherent instabilities...] There is only one arangement of particles which projects to the desired density while maintaining a finite emittance: the KV distribution. The KV distribution is an equilibrium solution of the Vlasov-Poisson equations, which describe the self-consistent dynamics of the beam in response to external and self-generated forces. If we start with a KV distribution in the ring, it will maintain its functional form as it evolves. This is a remarkable fact that I don't have the space to discuss here. The point is that the KV distribution is an obvious target if we want to minimize the tune spread.

The connection to vortex beams comes when we try to *paint* the KV distribution. It is *impossible* to paint a KV distribution in the presence of space charge. Well, not impossible: we can easily paint a completely *flat* KV distribution, i.e., a KV distribution with $\varepsilon_y = 0$ or $\varepsilon_x = 0$. But then we're back to the same problem: the flat beam will have enormous density and associate space charge forces. Again, we can play a trick: linearly map the flat KV distribution to a round, rotating distribution. It will turn out that we *can* paint the round, rotating distribution, which has zero four-dimensional emittance ($\varepsilon_2 \ll \varepsilon_1$) but still projects to a uniform density in the $x$-$y$ plane. I'll explain this more when defining the painting methods in the next section.







## Experimental implementation of eigenpainting  {#sec-exp}

Test

## Questions and future work  {#sec-conclusion}


Test
